{% extends 'base.html.twig' %}

{% block title %}Les annonces{% endblock %}
{% block stylesheets %}
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css"
          integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ=="
          crossorigin=""/>

    <style>
        .leaflet-div-icon{
            min-height: 30px;
            min-width: 60px;
            background-color: white;
            border-radius: 12px;
            color: #0f0f0f;
            font-size: 14px;
            text-align: center;
            display: flex;
            justify-content: center;
            align-items: center;

        }
        .leaflet-popup-content, .leaflet-popup-content-wrapper{
            margin: 0;
            padding: 0;
        }
        .card .card-map{
            max-height: 300px;
            max-width: 274px;
        }
        .carousel-inner{
            margin: auto;
            border-top-left-radius: 12px;
            border-top-right-radius: 12px;
        }

        a{

            vertical-align: middle;

        }
    </style>
{% endblock %}

{% block body %}
    <div class="container">
        <div class="jumbotron">
            {{ form_start(form) }}
            <div class="form-row">
                <div class="col">
                    {{ form_row(form.maxPrice) }}
                </div>
                <div class="col">
                    {{ form_row(form.minRooms) }}
                </div>
            </div>
            <div class="form-row">
                <div class="col">
                    <div class="form-group">
                        <label for="ad_adress">Adresse</label>
                        <input type="text" id="ad_adress">
                    </div>
                </div>
                <div class="col text-center">

                    <div class="form-group">
                        <label for="{{ form.distance.vars.id }}">{{ form_label(form.distance) }}</label>
                        {{ form_widget(form.distance) }}
                        <span id="distance_value" class="text-center"></span>
                    </div>
                </div>
            </div>

            <div class="form-row">
                <div class="col">
                    {{ form_row(form.options) }}
                </div>
            </div>

            <div class="col-12">
                <button type="submit" class="btn btn-primary">Rechercher</button>
            </div>
            {{ form_end(form) }}
        </div>
        <h1 class="my-4">Voici les annonces de nos h√¥tes</h1>
        <div class="row">
            {{ dump(paginator.items) }}
            {% for ad in paginator %}
                {% include 'common/_ad.html.twig'  with {'ad': ad }%}
            {% endfor %}
        </div>
    </div>

    {#{{ paginator.display }}#}
    <div class="navigation">
        {{ knp_pagination_render(paginator) }}
    </div>

    <div id="map" style="width: 100%; height: 1500px"></div>


{% endblock %}
{% block javascripts %}
    <script>
        $(document).ready(function () {
            $('#minRooms').attr({max:{{ stats.maxRooms }}, min: 1});
            $('#distance_value').text($("#distance").val() + ' km');
        })
        $('#distance').mousedown(e => {
            $(document).mousemove(e => {
                $('#distance_value').text($("#distance").val() + ' km');
            });
        });



        let map1 = document.querySelector('#map')
        if (map1 !== null){

            var map = L.map('map', {worldCopyJump: true}).setView([51.505, -0.09], 5)

            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                maxZoom: 19,
                minZoom: 3,
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors for <a href="{{ path('home') }}">FlashBnb</a>'
            }).addTo(map);
            customOptions = {'closeButton': 'false'}


            {% for ad in paginator.items %}
            {#marker = L.marker([{{ ad.lat }}, {{ ad.lng }}]).bindPopup("<a href='{{ path('ads_show', {'slug': ad.slug}) }}'>{{ ad.price }} &euro;</a>").addTo(map).openPopup();#}

            card = "<div class=\"card card-map\" style=\"width: 18rem;\">\n" +
                "    <div id=\"carouselExampleIndicators\" class=\"carousel slide\" data-ride=\"carousel\">\n" +
                "        <ol class=\"carousel-indicators\">\n" +
                "            {% for image in ad.images %}\n" +
                "                <li data-target=\"#carouselExampleIndicators\" data-slide-to=\"{{ loop.index0 }}\"\n" +
                "                    class=\"{% if loop.first %}active{% endif %}\"></li>\n" +
                "            {% endfor %}\n" +
                "        </ol>\n" +
                "        <div class=\"carousel-inner\">\n" +
                "            {% for image in ad.images %}\n" +
                "                <div class=\"carousel-item{% if loop.first %} active{% endif %}\">\n" +
                "                    <img class=\"d-block w-100\" src=\"{{ image.url }}\" alt=\"First slide\">\n" +
                "                    <div class=\"carousel-caption d-none d-md-block\">\n" +
                "                        <h5>{{ ad.title }}</h5>\n" +
                "                        <p>{{ image.caption }}</p>\n" +
                "                    </div>\n" +
                "                </div>\n" +
                "            {% endfor %}\n" +
                "        </div>\n" +
                "        <a class=\"carousel-control-prev\" href=\"#carouselExampleIndicators\" role=\"button\"\n" +
                "           data-slide=\"prev\">\n" +
                "            <span class=\"carousel-control-prev-icon\" aria-hidden=\"true\"></span>\n" +
                "            <span class=\"sr-only\">Previous</span>\n" +
                "        </a>\n" +
                "        <a class=\"carousel-control-next\" href=\"#carouselExampleIndicators\" role=\"button\"\n" +
                "           data-slide=\"next\">\n" +
                "            <span class=\"carousel-control-next-icon\" aria-hidden=\"true\"></span>\n" +
                "            <span class=\"sr-only\">Next</span>\n" +
                "        </a>\n" +
                "    </div>\n" +
                "    <div class=\"card-body\">\n" +
                "        <h5 class=\"card-title\">{{ ad.title }}</h5>\n" +
                "        <p class=\"card-text\">{{ ad.introduction }}</p>\n" +
                "        <a href=\"{{ path('ads_show', {'slug': ad.slug}) }}\">Voir l'annonce</a>\n" +
                "    </div>\n" +
                "</div>"
            {#var popup = L.popup({autoClose: true, closeButton: true, maxWidth:254, maxHeight:10})
                .setLatLng([{{ ad.lat }}, {{ ad.lng }}])
                .setContent(card);#}


                divIcon = L.divIcon({popupAnchor:[20, -10], html:"<b class='align-middle'>{{ ad.price }} &euro;</b>"});
                marker = L.marker([{{ ad.lat }}, {{ ad.lng }}], {icon:divIcon}).bindPopup(card, {closeButton:false}).addTo(map)

            {% endfor %}

        }
    </script>
{% endblock %}
